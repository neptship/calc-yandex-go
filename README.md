# сalc-yandex-go

Cервис на Go для вычисления арифметических выражений. Сервис принимает математические выражения через POST-запросы и возвращает вычисленные результаты.

## Функциональность

- Асинхронное вычисление арифметических выражений
- Поддержка базовых арифметических операций (+, -, *, /)
- Поддержка скобок для управления порядком операций
- Формат обмена данными JSON
- Распределённое выполнение операций между агентами
- История вычислений с подробной информацией
- Веб-интерфейс для удобного использования
- Обработка ошибок с соответствующими HTTP-кодами

## Установка и запуск

### Предварительные требования

- Установленный Go (версия 1.20 или выше)
- Node.js 18+ и npm (для фронтенда)
- Docker и Docker Compose (для запуска через Docker)
- Make (опционально, для упрощения запуска)

### Запуск через Make
Для удобства запуска всех компонентов системы используйте команды Make:

```bash
# Клонирование репозитория
git clone https://github.com/neptship/calc-yandex-go
cd calc-yandex-go

# Запуск всех компонентов (оркестратор, агент, фронтенд)
make run-all

# Запуск только оркестратора
make run-orchestrator

# Запуск только агента
make run-agent

# Запуск только фронтенда
make run-frontend

# Запуск тестов
make test
```

### Запуск через Docker
Проект поддерживает запуск через Docker и Docker Compose:

```bash
git clone https://github.com/neptship/calc-yandex-go
cd calc-yandex-go
docker-compose up
```

### Ручной запуск

**Запуск оркестратора**
```bash
git clone https://github.com/neptship/calc-yandex-go
cd calc-yandex-go
go run cmd/orchestrator/main.go
```

**Запуск агентов (В отдельном терминале)**

```bash
cd calc-yandex-go
go run cmd/agent/main.go
```

По умолчанию оркестратор запускается на порту 8080.

### Запуск фронтенда

```bash
cd calc-yandex-go/frontend
npm install
npm run dev
```

Веб-интерфейс будет доступен по адресу: http://localhost:3000

## API Спецификация

### POST /api/v1/calculate

Отправляет выражение на вычисление и возвращает идентификатор задачи.

**Формат запроса:**
```json
{
    "expression": "2+2*2"
}
```

**Успешный ответ (201 Created):**
```json
{
    "id": 1
}
```

**Ответ при некорректном выражении (422 Unprocessable Entity):**
```json
{
    "error": "invalid expression"
}
```

**Ответ при внутренней ошибке сервера (500 Internal Server Error):**
```json
{
    "error": "internal server error"
}
```

### GET /api/v1/expressions/:id

Получает статус и результат вычисления по идентификатору.

**Успешный ответ (200 OK), вычисление завершено:**

```json
{
    "expression": {
        "id": 1,
        "status": "completed",
        "result": 6
    }
}
```

**Успешный ответ (200 OK), вычисление в процессе:**

```json
{
    "expression": {
        "id": 1,
        "status": "processing"
    }
}
```

**Выражение не найдено (404 Not Found):**

```json
{
    "error": "Expression not found"
}
```

### GET /api/v1/expressions

Получает список всех выражений и их статусов.

**Успешный ответ (200 OK):**

```json
{
    "expressions": [
        {
            "id": 1,
            "status": "completed",
            "result": 6
        },
        {
            "id": 2,
            "status": "processing"
        }
    ]
}
```

## Примеры использования

### Отправка выражения на вычисление
```bash
curl --location 'http://localhost:8080/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{
    "expression": "2+2*2"
}'
```

Ответ:
```json
{
    "id": 1
}
```

### Некорректное выражение
```bash
curl --location 'http://localhost:8080/api/v1/calculate' \
--header 'Content-Type: application/json' \
--data '{
    "expression": "2+2ё"
}'
```

Ответ:
```json
{
    "error": "invalid character"
}
```

### Получение результата вычисления
```bash
curl --location 'http://localhost:8080/api/v1/expressions/1'
```

Ответ:
```json
{
    "expression": {
        "id": 1,
        "status": "completed",
        "result": 6
    }
}
```

### Получение списка всех выражений

```bash
curl --location 'http://localhost:8080/api/v1/expressions'
```

## Настройка

Система настраивается через переменные окружения:
- `PORT` - порт для HTTP-сервера (по умолчанию 8080)
- `COMPUTING_POWER` - количество параллельных вычислителей в агенте (по умолчанию 3)
- `TIME_ADDITION_MS` - время выполнения сложения (по умолчанию 1000 мс)
- `TIME_SUBTRACTION_MS` - время выполнения вычитания (по умолчанию 1000 мс)
- `TIME_MULTIPLICATIONS_MS` - время выполнения умножения (по умолчанию 1500 мс)
- `TIME_DIVISIONS_MS` - время выполнения деления (по умолчанию 2000 мс)


## Ограничения

- Поддерживаются только положительные целые числа
- Использование унарного минуса или плюса приведет к некорректной работе
- Поддерживаются только POST-запросы
- Все нестандартные символы в выражении (буквы, спецсимволы) приведут к ошибке 422

## Веб-интерфейс
Веб-интерфейс предоставляет следующие возможности:
- Ввод арифметических выражений
- Отображение прогресса вычислений в реальном времени
- История вычислений с результатами
- Просмотр подробной информации в JSON-формате
- Очистка истории

## Рекомендации по тестированию

- Рекомендуется использовать Postman для тестирования API, так как с curl могут возникнуть проблемы
- При использовании curl рекомендуется выполнять запросы через git bash терминал
- Для тестирования асинхронных вычислений сделайте запрос, а затем периодически запрашивайте результат